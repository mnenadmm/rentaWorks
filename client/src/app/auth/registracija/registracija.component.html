<div class="registracija-wrapper">
  <div class="registracija-container">
    <h2>Registruj se</h2>
    <div class="progress-bar">
      <div class="progress-line"></div>
      <div class="steps">
        <div 
          class="step" 
          *ngFor="let s of steps; let i = index"
          [class.active]="currentStep === i + 1"
          [class.completed]="currentStep > i + 1"
        >
          {{ i + 1 }}
        </div>
      </div>
    </div>

    <form [formGroup]="step1Form" (ngSubmit)="nextStep()">

      <ng-container *ngIf="currentStep === 2">
        <div class="form-group">
          <label for="username">Korisničko ime</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="text"
              id="username"
              formControlName="username"
              placeholder="Unesi korisničko ime"
            />
          </div>
          <div *ngIf="step1Form.get('username')?.touched && step1Form.get('username')?.invalid" class="error">
            Korisničko ime je obavezno (min 4 karaktera).
          </div>
        </div>

        <div class="form-group">
          <label for="ime">Ime</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="text"
              id="ime"
              formControlName="ime"
              placeholder="Unesi ime"
            />
          </div>
          <div *ngIf="step1Form.get('ime')?.touched && step1Form.get('ime')?.invalid" class="error">
            Ime je obavezno.
          </div>
        </div>

        <div class="form-group">
          <label for="prezime">Prezime</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="text"
              id="prezime"
              formControlName="prezime"
              placeholder="Unesi prezime"
            />
          </div>
          <div *ngIf="step1Form.get('prezime')?.touched && step1Form.get('prezime')?.invalid" class="error">
            Prezime je obavezno.
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="email"
              id="email"
              formControlName="email"
              placeholder="Unesi email"
            />
          </div>
          <div *ngIf="step1Form.get('email')?.touched && step1Form.get('email')?.invalid" class="error">
            Unesite validan email.
          </div>
        </div>

       <div class="form-group">
  <label for="lozinka">Lozinka</label>
  <div class="input-icon password-wrapper">
    <i class="icon">🔒</i>
    <input
      [type]="showPassword ? 'text' : 'password'"
      id="password"
      formControlName="password"
      placeholder="Unesi lozinku"
      
    />
    <button
      type="button"
      class="toggle-password"
      (click)="togglePasswordVisibility()"
      [attr.aria-label]="showPassword ? 'Sakrij lozinku' : 'Prikaži lozinku'"
      [disabled]="isLockedOut"
    >
      {{ showPassword ? '🙈' : '👁️' }}
    </button>
  </div>
  <div *ngIf="step1Form.get('password')?.touched && step1Form.get('password')?.invalid" class="error">
    Lozinka je obavezna i mora imati najmanje 8 karaktera.
  </div>
</div>

<div class="form-group">
  <label for="confirmPassword">Potvrdi lozinku</label>
  <div class="input-icon password-wrapper">
    <i class="icon">🔒</i>
    <input
      [type]="showPassword ? 'text' : 'password'"
      id="confirmPassword"
      formControlName="confirmPassword"
      placeholder="Ponovo unesi lozinku"
    
    />
  </div>
  <div *ngIf="step1Form.get('confirmPassword')?.touched && step1Form.get('confirmPassword')?.invalid" class="error">
    Potvrda lozinke je obavezna.
  </div>
  <div *ngIf="step1Form.errors?.['passwordMismatch'] && (step1Form.touched || step1Form.dirty)" class="error">
  Lozinke se ne poklapaju.
</div>
</div>

        

        <div class="buttons">
          <button type="submit" [disabled]="step1Form.invalid">Dalje</button>
        </div>
      </ng-container>

      <ng-container *ngIf="currentStep === 1">
        <div class="form-group">
  <label for="drzavljanstvo">Državljanstvo:</label>
  <div class="input-icon">
    <i class="icon">🌍</i>
    <select
      id="drzavljanstvo"
      formControlName="drzavljanstvo"
      [(ngModel)]="korisnik.drzavljanstvo"
    >
      <option value="">-- Izaberite državljanstvo --</option>
      <option *ngFor="let drzava of drzave" [value]="drzava.code">
        {{ drzava.name }}
      </option>
    </select>
    <div *ngIf="step1Form.get('drzavljanstvo')?.touched && step1Form.get('drzavljanstvo')?.invalid" class="error">
    Molimo izaberite državljanstvo.
  </div>
  </div>
</div>

        <div class="buttons">
          <button type="button" (click)="prevStep()">Nazad</button>
          <button type="button" (click)="nextStep()">Dalje</button>
        </div>
      </ng-container>

      <ng-container *ngIf="currentStep === 3">
        <h5>Treći korak forme</h5>
        <div class="buttons">
          <button type="button" (click)="prevStep()">Nazad</button>
          <button type="button" (click)="nextStep()">Dalje</button>
        </div>
      </ng-container>

      <ng-container *ngIf="currentStep === 4">
        <h5>Završi</h5>
        <div class="buttons">
          <button type="button" (click)="prevStep()">Nazad</button>
          <button type="button" (click)="submit()" [disabled]="step1Form.invalid">Pošalji</button>
        </div>
      </ng-container>

    </form>
  </div>
</div>
