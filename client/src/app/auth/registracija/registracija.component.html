<div class="registracija-wrapper">
  <div class="registracija-container">
    <h2>Registruj se</h2>

    <div class="progress-bar">
      <div class="progress-line"></div>
      <div class="steps">
        <div
          class="step"
          *ngFor="let s of steps; let i = index"
          [class.active]="currentStep === i + 1"
          [class.completed]="currentStep > i + 1"
        >
          {{ i + 1 }}
        </div>
      </div>
    </div>

    <form [formGroup]="getCurrentForm()" (ngSubmit)="handleSubmit()">
      <!-- STEP 1 -->
      <ng-container *ngIf="currentStep === 1">
        <!-- Korisničko ime -->
        <div class="form-group">
          <label for="username">Korisničko ime</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="text"
              id="username"
              formControlName="username"
              placeholder="Unesi korisničko ime"
            />
          </div>
          <div *ngIf="step1Form.get('username')?.touched && step1Form.get('username')?.invalid" class="error">
            Korisničko ime je obavezno (min 4 karaktera).
          </div>
        </div>

        <!-- Ime -->
        <div class="form-group">
          <label for="ime">Ime</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="text"
              id="ime"
              formControlName="ime"
              placeholder="Unesi ime"
            />
          </div>
          <div *ngIf="step1Form.get('ime')?.touched && step1Form.get('ime')?.invalid" class="error">
            Ime je obavezno.
          </div>
        </div>

        <!-- Prezime -->
        <div class="form-group">
          <label for="prezime">Prezime</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="text"
              id="prezime"
              formControlName="prezime"
              placeholder="Unesi prezime"
            />
          </div>
          <div *ngIf="step1Form.get('prezime')?.touched && step1Form.get('prezime')?.invalid" class="error">
            Prezime je obavezno.
          </div>
        </div>

        <!-- Email -->
        <div class="form-group">
          <label for="email">Email</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="email"
              id="email"
              formControlName="email"
              placeholder="Unesi email"
            />
          </div>
          <div *ngIf="step1Form.get('email')?.touched && step1Form.get('email')?.invalid" class="error">
            Unesite validan email.
          </div>
        </div>

        <!-- Lozinka -->
        <div class="form-group">
          <label for="lozinka">Lozinka</label>
          <div class="input-icon password-wrapper">
            <i class="icon">🔒</i>
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="password"
              formControlName="password"
              placeholder="Unesi lozinku"
            />
            <button
              type="button"
              class="toggle-password"
              (click)="togglePasswordVisibility()"
              [attr.aria-label]="showPassword ? 'Sakrij lozinku' : 'Prikaži lozinku'"
              [disabled]="isLockedOut"
            >
              {{ showPassword ? '🙈' : '👁️' }}
            </button>
          </div>
          <div *ngIf="step1Form.get('password')?.touched && step1Form.get('password')?.invalid" class="error">
            Lozinka je obavezna i mora imati najmanje 8 karaktera.
          </div>
        </div>

        <!-- Potvrdi lozinku -->
        <div class="form-group">
          <label for="confirmPassword">Potvrdi lozinku</label>
          <div class="input-icon password-wrapper">
            <i class="icon">🔒</i>
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="confirmPassword"
              formControlName="confirmPassword"
              placeholder="Ponovo unesi lozinku"
            />
          </div>
          <div *ngIf="step1Form.get('confirmPassword')?.touched && step1Form.get('confirmPassword')?.invalid" class="error">
            Potvrda lozinke je obavezna.
          </div>
          <div *ngIf="step1Form.errors?.['passwordMismatch'] && (step1Form.touched || step1Form.dirty)" class="error">
            Lozinke se ne poklapaju.
          </div>
        </div>

        <div class="buttons">
          <button type="submit" [disabled]="step1Form.invalid">Dalje</button>
        </div>
      </ng-container>

      <!-- STEP 2 -->
      <ng-container *ngIf="currentStep === 2">
        <div class="form-group">
          <label for="drzavljanstvo">Državljanstvo:</label>
          <div class="input-icon">
            <i class="icon">🌍</i>
            <select id="drzavljanstvo" formControlName="drzavljanstvo">
              <option value="">-- Izaberite državljanstvo --</option>
              <option *ngFor="let drzava of drzave" [value]="drzava.code">
                {{ drzava.name }}
              </option>
            </select>
          </div>
          <div *ngIf="step2Form.get('drzavljanstvo')?.touched && step2Form.get('drzavljanstvo')?.invalid" class="error">
            Molimo izaberite državljanstvo.
          </div>
        </div>
        <div class="form-group">
          <label for="username">Adresa</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="adresa"
              id="adresa"
              formControlName="adresa"
              placeholder="Unesite vasu adresu"
            />
          </div>
          <div *ngIf="step2Form.get('adresa')?.touched && step2Form.get('adresa')?.invalid" class="error">
            Adresa je obavezno polje 
          </div>
        </div>
        <div class="form-group">
          <label for="adresaBroj">Broj</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="number"
              id="adresaBroj"
              formControlName="adresaBroj"
              placeholder="Unesite broj"
            />
          </div>
          <div *ngIf="step2Form.get('adresaBroj')?.touched && step2Form.get('adresaBroj')?.invalid" class="error">
            Unesite broj stanovanja
          </div>
        </div>
        <div class="form-group">
          <label for="username">Grad</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="grad"
              id="grad"
              formControlName="grad"
              placeholder="Unesite grad"
            />
          </div>
          <div *ngIf="step2Form.get('grad')?.touched && step2Form.get('grad')?.invalid" class="error">
            Unesite grad 
          </div>
        </div>
        <div class="form-group">
          <label for="username">Telefon</label>
          <div class="input-icon">
            <i class="icon">&#64;</i>
            <input
              type="tel"
              id="telefon"
              formControlName="telefon"
              placeholder="Telefon"
            />
          </div>
          <div *ngIf="step2Form.get('telefon')?.touched && step2Form.get('telefon')?.invalid" class="error">
            Unesite telefon
          </div>
        </div>
        <div class="buttons">
          <button type="button" (click)="prevStep()">Nazad</button>
          <button type="submit" [disabled]="step2Form.invalid">Dalje</button>
        </div>
      </ng-container>

      <!-- STEP 3 -->
      <ng-container *ngIf="currentStep === 3">
        <div class="form-group">
            <label>Tip korisnika:</label><br>

  <label>
    <input type="radio" formControlName="tipKorisnika" value="fizicko" style="transform: scale(1.3); margin-right: 8px;">
    Fizičko lice
  </label>

  <label style="margin-left: 20px;">
    <input type="radio" formControlName="tipKorisnika" value="pravno" style="transform: scale(1.3); margin-right: 8px;">
    Pravno lice
  </label> 
        </div>
        
        
        <div class="buttons">
          <button type="button" (click)="prevStep()">Nazad</button>
          <button type="submit">Dalje</button>
        </div>
      </ng-container>

      <!-- STEP 4 -->
      <ng-container *ngIf="currentStep === 4">
        <h5>Završi</h5>
        <div class="buttons">
          <button type="button" (click)="prevStep()">Nazad</button>
          <button type="button" (click)="submit()" [disabled]="step1Form.invalid">Pošalji</button>
        </div>
      </ng-container>
    </form>
  </div>
</div>
